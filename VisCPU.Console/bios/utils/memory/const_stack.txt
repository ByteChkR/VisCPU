; Include Constant Header Files for Bios Registers and Functions
:include "../register_layout.txt" 

:const STACK_SIZE 0xFF linker:hide
:data STACK_MEM 0xFF 0x00 linker:hide
:data STACK_MEM_NEXT 0x01 0x00 linker:hide

.init
	LOAD STACK_MEM_NEXT STACK_MEM
	RET

.pop ; Returns REG_A = Popped Value
	JSR check_has_items
	DEC STACK_MEM_NEXT
	LOAD REG_B REG_A
	CREF STACK_MEM_NEXT REG_B
	RET

.peek ; Returns REG_A = peeked value
	JSR check_has_items
	DEC STACK_MEM_NEXT
	LOAD REG_B REG_A
	CREF STACK_MEM_NEXT REG_B
	INC STACK_MEM_NEXT
	RET

.push ; (REG_A = Value to Push)
	JSR check_is_out_of_memory
	LOAD REG_X REG_A
	CREF REG_X STACK_MEM_NEXT
	INC STACK_MEM_NEXT
	RET

.check_has_items linker:hide;
	LOAD REG_B STACK_MEM
	BEQ STACK_MEM_NEXT REG_B stack_error_handler
	RET

.check_is_out_of_memory linker:hide ;
	COPY STACK_MEM_NEXT REG_B
	LOAD REG_Y STACK_MEM
	SUB REG_B REG_Y ; 0-Based Length
	INC REG_B
	LOAD REG_X STACK_SIZE
	BGT REG_B REG_X stack_error_handler
	RET

.stack_error_handler linker:hide
	;BRK
	HLT